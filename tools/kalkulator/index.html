<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kalkulator – Luderbein</title>
  <meta name="description" content="V0 Kalkulator: auswählen, Text erzeugen, 1:1 per WhatsApp oder E-Mail schicken." />
  <link rel="stylesheet" href="/assets/style.css" />
  <link rel="stylesheet" href="/assets/nav-dropdown.css" />
</head>
<body>
  <header>
    <div class="wrap nav">
      <a class="brand" href="/">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <strong>Luderbein</strong><br>
          <span>Schwibbögen • Gravur • Sonderwünsche</span>
        </div>
      </a>

      <button class="navbtn" type="button" data-nav-toggle aria-expanded="false" aria-label="Menü öffnen">
        <span class="navicon"><span></span></span>
      </button>

      <nav class="menu" data-nav data-open="0" aria-label="Hauptmenü">
        <a href="/">Start</a>

        <!-- EIN Dropdown für Leistungen -->
        <details class="navdrop" data-navdrop>
          <summary class="navdrop__sum" aria-label="Leistungen öffnen">
            Leistungen <span class="navdrop__chev" aria-hidden="true">▾</span>
          </summary>

          <div class="navdrop__panel" role="menu" aria-label="Leistungen">
            <a href="/leistungen/schiefer/" role="menuitem">Schiefer</a>
            <a href="/leistungen/metall/" role="menuitem">Metall</a>
            <a href="/leistungen/holz/" role="menuitem">Holz</a>
            <a href="/kontakt/?p=Custom" role="menuitem">Custom</a>

            <div class="navdrop__sep" aria-hidden="true"></div>

            <a href="/tools/kalkulator/" role="menuitem" aria-current="page">Kalkulator</a>
            <a href="/service/" role="menuitem">Downloads</a>
          </div>
        </details>

        <a href="/ueber/">Über</a>
        <a href="/kontakt/">Kontakt</a>
        <a href="/rechtliches/impressum.html">Impressum</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <span class="badge"><i></i> Tool</span>
      <h1>Kalkulator (V0)</h1>
      <p class="lead">
        Du wählst grob vor – der Kalkulator erzeugt dir einen fertigen Text.
        Den schickst du 1:1 per WhatsApp oder Mail. Kein Shop-Gedöns.
      </p>

      <div class="notice">
        <strong style="color:var(--text)">Hinweis:</strong><br>
        “Kalkulieren” heißt hier: Preisrahmen + Rückfragen. Kein automatischer Endpreis.
      </div>

      <div class="cta" style="margin-top:14px">
        <a class="btn primary" id="waLinkTop" href="https://wa.me/491725925858?text=Hi%20Luderbein%2C%20ich%20m%C3%B6chte%20kalkulieren%3A%0A" rel="noopener">WhatsApp</a>
        <a class="btn" id="mailLinkTop" href="mailto:luderbein_gravur@icloud.com?subject=Kalkulation%20%E2%80%93%20Luderbein&body=Hi%20Luderbein%2C%0A%0Aich%20m%C3%B6chte%20kalkulieren%3A%0A">E-Mail</a>
        <a class="btn" href="/kontakt/?p=Custom">Sonderanfrage</a>
      </div>
    </section>

    <section class="section" aria-label="Kalkulator Auswahl">
      <div class="section-head">
        <h2>Kalkulieren</h2>
        <p class="small muted">Erst Oberkategorie wählen → dann Details. Unten entsteht dein fertiger Text.</p>
      </div>

      <div class="grid" style="grid-template-columns: 1fr; gap:14px;">
        <div class="card">
          <h3>Oberkategorie</h3>

          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <select id="material" style="max-width:320px;">
              <option value="" selected>Bitte wählen…</option>
              <option value="schiefer">Schiefer</option>
              <option value="metall">Metall</option>
              <option value="holz">Holz</option>
              <option value="custom">Custom / Sonderfall</option>
            </select>

            <a class="btn" href="/leistungen/">Info-Bereich (Leistungen)</a>
          </div>

          <p class="small muted" style="margin-top:10px">
            Tipp: Wenn du nur “irgendwas Wildes” willst → Custom wählen.
          </p>
        </div>

        <!-- SCHIEFER (spezial) -->
        <div class="card" id="schieferBox" style="display:none;">
          <h3>Schiefer – Details</h3>

          <div class="grid" style="grid-template-columns: 1fr; gap:12px;">
            <div>
              <strong>Form</strong>
              <div class="cta" style="gap:10px; flex-wrap:wrap; margin-top:10px;">
                <label class="btn" style="cursor:pointer">
                  <input type="radio" name="shape" value="rund" checked style="margin-right:8px"> rund
                </label>
                <label class="btn" style="cursor:pointer">
                  <input type="radio" name="shape" value="eckig" style="margin-right:8px"> eckig
                </label>
              </div>
            </div>

            <div>
              <strong>Größe</strong>
              <div class="cta" style="gap:10px; flex-wrap:wrap; margin-top:10px;">
                <label class="btn" style="cursor:pointer"><input type="radio" name="size" value="10" checked style="margin-right:8px"> 10</label>
                <label class="btn" style="cursor:pointer"><input type="radio" name="size" value="15" style="margin-right:8px"> 15</label>
                <label class="btn" style="cursor:pointer"><input type="radio" name="size" value="20" style="margin-right:8px"> 20</label>
                <label class="btn" style="cursor:pointer"><input type="radio" name="size" value="custom" style="margin-right:8px"> anders</label>
              </div>

              <div style="margin-top:10px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <input id="sizeCustom" type="text" inputmode="numeric" placeholder="z. B. 25" style="display:none; max-width:160px" />
                <span class="small muted" id="sizeUnit" style="display:none">cm</span>
              </div>
            </div>

            <div>
              <strong>Art (optional)</strong>
              <div class="cta" style="gap:10px; flex-wrap:wrap; margin-top:10px;">
                <label class="btn" style="cursor:pointer"><input type="radio" name="kind" value="Foto" checked style="margin-right:8px"> Foto</label>
                <label class="btn" style="cursor:pointer"><input type="radio" name="kind" value="Text + Symbol" style="margin-right:8px"> Text + Symbol</label>
                <label class="btn" style="cursor:pointer"><input type="radio" name="kind" value="Gedenktafel" style="margin-right:8px"> Gedenktafel</label>
              </div>
            </div>

            <div>
              <strong>Menge</strong>
              <div style="margin-top:10px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <input id="qtySchiefer" type="number" min="1" value="1" style="max-width:120px" />
                <span class="small muted">Stück</span>
              </div>
            </div>
          </div>
        </div>

        <!-- GENERISCH (Metall/Holz/Custom) -->
        <div class="card" id="genericBox" style="display:none;">
          <h3 id="genericTitle">Details</h3>

          <div class="grid" style="grid-template-columns: 1fr; gap:12px;">
            <div>
              <strong>Produkt / Artikel</strong>
              <input id="prodName" type="text" placeholder="z. B. Hundemarke, Visitenkarte, Schild, Schwibbogen…" style="width:100%; margin-top:10px;" />
            </div>

            <div>
              <strong>Größe / Format</strong>
              <input id="format" type="text" placeholder="z. B. 12 mm rund / 80×50 mm / A3 / 20×20 cm" style="width:100%; margin-top:10px;" />
            </div>

            <div>
              <strong>Menge</strong>
              <div style="margin-top:10px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <input id="qtyGeneric" type="number" min="1" value="1" style="max-width:120px" />
                <span class="small muted">Stück</span>
              </div>
            </div>

            <div>
              <strong>Motiv / Text / Wunsch</strong>
              <textarea id="wish" rows="4" style="width:100%; resize:vertical; margin-top:10px;" placeholder="Kurz beschreiben: Text, Motiv, Icon, Stil, ggf. Link/Datei…"></textarea>
            </div>
          </div>

          <div class="notice" style="margin-top:12px;">
            <strong style="color:var(--text)">Wenn du Dateien hast:</strong>
            Foto/Logo/Skizze direkt mit schicken – spart 2 Runden.
          </div>
        </div>

        <!-- OUTPUT -->
        <div class="card" id="outBox" style="display:none;">
          <h3>Fertiger Text</h3>
          <p class="small muted">Das schickst du 1:1 (oder passt es kurz an).</p>

          <textarea id="outText" rows="8" style="width:100%; resize:vertical"></textarea>

          <div class="cta" style="margin-top:10px; gap:10px; flex-wrap:wrap;">
            <button class="btn" type="button" id="copyBtn">Text kopieren</button>
            <a class="btn primary" id="waLink" href="#" rel="noopener">WhatsApp mit Text</a>
            <a class="btn" id="mailLink" href="#">E-Mail mit Text</a>
            <a class="btn" href="/kontakt/?p=Custom">Sonderanfrage</a>
          </div>
        </div>

      </div>
    </section>
  </main>

  <footer>
    <div class="wrap foot">
      <div class="small">© <span id="y"></span> Luderbein</div>
      <div class="small">
        <a href="/rechtliches/impressum.html">Impressum</a> ·
        <a href="/rechtliches/datenschutz.html">Datenschutz</a>
      </div>
    </div>
  </footer>

  <script src="/assets/site.js"></script>
  <script src="/assets/nav-dropdown.js"></script>
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    (function(){
      const params = new URLSearchParams(location.search);

      const material = document.getElementById('material');

      const schieferBox = document.getElementById('schieferBox');
      const genericBox = document.getElementById('genericBox');
      const genericTitle = document.getElementById('genericTitle');

      const outBox = document.getElementById('outBox');
      const outText = document.getElementById('outText');

      const waLink = document.getElementById('waLink');
      const mailLink = document.getElementById('mailLink');

      const waLinkTop = document.getElementById('waLinkTop');
      const mailLinkTop = document.getElementById('mailLinkTop');

      const sizeCustom = document.getElementById('sizeCustom');
      const sizeUnit = document.getElementById('sizeUnit');

      function schieferFormat(shape, size){
        const n = String(size || '').trim();
        if(!n) return '';
        if(shape === 'eckig') return `${n}×${n} cm (eckig)`;
        return `${n} cm (rund)`;
      }

      function getSelected(name){
        const el = document.querySelector(`input[name="${name}"]:checked`);
        return el ? el.value : '';
      }

      function buildText(){
        const m = (material.value || '').trim();

        if(!m) return '';

        if(m === 'schiefer'){
          const shape = getSelected('shape') || 'rund';
          const sizeVal = getSelected('size') || '10';
          const kind = getSelected('kind') || 'Foto';
          const qty = (document.getElementById('qtySchiefer')?.value || '1');

          let size = sizeVal;
          if(sizeVal === 'custom'){
            size = (sizeCustom?.value || '').trim();
          }

          const format = schieferFormat(shape, size);

          return (
            `Kalkulation – Schiefer\n` +
            `Form: ${shape}\n` +
            `Größe/Format: ${format}\n` +
            `Art: ${kind}\n` +
            `Menge: ${qty}\n` +
            `Motiv/Text: \n` +
            `Hinweis: Foto/Datei sende ich direkt mit.\n`
          );
        }

        // generisch
        const titleMap = { metall:'Metall', holz:'Holz', custom:'Custom / Sonderfall' };
        const label = titleMap[m] || m;

        const prod = (document.getElementById('prodName')?.value || '').trim();
        const fmt = (document.getElementById('format')?.value || '').trim();
        const qty = (document.getElementById('qtyGeneric')?.value || '1');
        const wish = (document.getElementById('wish')?.value || '').trim();

        return (
          `Kalkulation – ${label}\n` +
          `Produkt/Artikel: ${prod || ''}\n` +
          `Größe/Format: ${fmt || ''}\n` +
          `Menge: ${qty}\n` +
          `Wunsch: ${wish || ''}\n` +
          `Hinweis: Dateien (Foto/Logo/Skizze) sende ich direkt mit.\n`
        );
      }

      function setLinks(text){
        const t = text || 'Hi Luderbein, ich möchte kalkulieren:\n';

        waLink.href = 'https://wa.me/491725925858?text=' + encodeURIComponent(t);
        mailLink.href = 'mailto:luderbein_gravur@icloud.com?subject=' + encodeURIComponent('Kalkulation – Luderbein') + '&body=' + encodeURIComponent(t);

        // top buttons immer aktiv (mit aktuellem Text, falls vorhanden)
        waLinkTop.href = 'https://wa.me/491725925858?text=' + encodeURIComponent(t);
        mailLinkTop.href = 'mailto:luderbein_gravur@icloud.com?subject=' + encodeURIComponent('Kalkulation – Luderbein') + '&body=' + encodeURIComponent(t);
      }

      function render(){
        const m = (material.value || '').trim();

        // reset views
        schieferBox.style.display = 'none';
        genericBox.style.display = 'none';

        if(!m){
          outBox.style.display = 'none';
          setLinks('Hi Luderbein, ich möchte kalkulieren:\n');
          return;
        }

        if(m === 'schiefer'){
          schieferBox.style.display = '';
          // custom size input
          const sizeVal = getSelected('size') || '10';
          const show = (sizeVal === 'custom');
          sizeCustom.style.display = show ? '' : 'none';
          sizeUnit.style.display = show ? '' : 'none';
        } else {
          genericBox.style.display = '';
          const titleMap = { metall:'Metall – Details', holz:'Holz – Details', custom:'Custom – Details' };
          genericTitle.textContent = titleMap[m] || 'Details';
        }

        // output
        const text = buildText();
        outText.value = text;
        outBox.style.display = '';

        setLinks(text);
      }

      function initFromQuery(){
        const t = (params.get('t') || '').toLowerCase().trim();
        if(t === 'schiefer' || t === 'metall' || t === 'holz' || t === 'custom'){
          material.value = t;
        }
      }

      // events
      material.addEventListener('change', function(){
        // URL optional mitziehen (nicht zwingend)
        if(material.value){
          params.set('t', material.value);
          history.replaceState(null, '', '?' + params.toString());
        } else {
          params.delete('t');
          history.replaceState(null, '', params.toString() ? ('?' + params.toString()) : location.pathname);
        }
        render();
      });

      // schiefer listeners
      document.querySelectorAll('input[name="shape"], input[name="size"], input[name="kind"]').forEach(el => {
        el.addEventListener('change', render);
      });
      document.getElementById('qtySchiefer')?.addEventListener('input', render);
      sizeCustom?.addEventListener('input', render);

      // generic listeners
      document.getElementById('prodName')?.addEventListener('input', render);
      document.getElementById('format')?.addEventListener('input', render);
      document.getElementById('qtyGeneric')?.addEventListener('input', render);
      document.getElementById('wish')?.addEventListener('input', render);

      document.getElementById('copyBtn')?.addEventListener('click', async () => {
        outText.focus();
        outText.select();
        try{
          await navigator.clipboard.writeText(outText.value);
        }catch(e){
          document.execCommand('copy');
        }
      });

      // init
      initFromQuery();
      render();
    })();
  </script>
</body>
</html>
