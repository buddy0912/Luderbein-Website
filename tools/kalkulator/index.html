<script>
  (function () {
    // wartet bis DOM da ist (falls Script im <head> oder async geladen wird)
    function ready(fn){ if(document.readyState !== 'loading') fn(); else document.addEventListener('DOMContentLoaded', fn); }

    ready(function(){
      const params = new URLSearchParams(location.search);

      // wir akzeptieren mehrere Parameter-Namen, damit du flexibel bist:
      // /tools/kalkulator/?topic=metall
      // /tools/kalkulator/?p=metall
      // /tools/kalkulator/?service=metall
      const raw =
        (params.get('topic') || params.get('p') || params.get('service') || '').trim().toLowerCase();

      if(!raw) return;

      // robustes Mapping
      const map = {
        'metall': 'metall',
        'metal': 'metall',
        'metallgravur': 'metall',
        'metall-gravur': 'metall',
        'schiefer': 'schiefer',
        'slate': 'schiefer'
      };

      const want = map[raw] || raw;

      // möglichst tolerant das Dropdown finden
      const sel =
        document.querySelector('select#topic') ||
        document.querySelector('select[name="topic"]') ||
        document.querySelector('select[data-topic]') ||
        document.querySelector('select');

      if(!sel) return;

      // WICHTIG: value muss exakt passen (z.B. <option value="metall">Metall</option>)
      // Wenn du im HTML <option value="Metall"> hast, klappt das NICHT -> dann value ändern!
      const has = Array.from(sel.options).some(o => (o.value || '').toLowerCase() === want);

      if(!has) return;

      // setzen + Change feuern (damit dein Kalkulator-Update-Code anspringt)
      sel.value = want;
      sel.dispatchEvent(new Event('change', { bubbles: true }));
    });
  })();
</script>
