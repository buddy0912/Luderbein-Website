<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kalkulator – Luderbein</title>
  <meta name="description" content="V0 Kalkulator: auswählen, kalkulieren, dann 1:1 per WhatsApp oder E-Mail anfragen." />
  <link rel="stylesheet" href="/assets/style.css" />
  <link rel="stylesheet" href="/assets/nav-dropdown.css" />

  <style>
    .calcbox{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.03);
      border-radius:18px;
      padding:16px;
    }
    .calcgrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 760px){
      .calcgrid{ grid-template-columns: 1fr; }
    }
    label.smalllab{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:0 0 6px 2px;
    }
    select, input[type="number"], textarea{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.25);
      color:var(--text);
      outline:none;
    }
    textarea{ min-height: 120px; resize: vertical; }

    .checkrow{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.02);
    }
    .checkrow input{ margin-top:3px; }
    .checkrow .muted{ font-size:12px; color:var(--muted); margin-top:2px; }

    .subcard{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.02);
      border-radius:16px;
      padding:14px;
      margin-top:14px;
    }

    .total{
      font-size:18px;
      font-weight:800;
      letter-spacing:.2px;
    }
    .warn{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,80,80,.25);
      background:rgba(255,80,80,.08);
      color:rgba(255,220,220,.95);
      font-size:13px;
      display:none;
    }
    .oknote{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.02);
      color:rgba(255,255,255,.85);
      font-size:13px;
      display:none;
    }

    .inline{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .inline .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);
      color:rgba(255,255,255,.86);
    }

    .radioStack{
      display:grid;
      gap:10px;
    }
  </style>
</head>

<body>
<header>
  <div class="wrap nav">
    <a class="brand" href="/">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <strong>Luderbein</strong><br>
        <span>Schwibbögen • Gravur • Sonderwünsche</span>
      </div>
    </a>

    <button class="navbtn" type="button" data-nav-toggle aria-expanded="false" aria-label="Menü öffnen">
      <span class="navicon"><span></span></span>
    </button>

    <nav class="menu" data-nav data-open="0" aria-label="Hauptmenü">
      <a href="/">Start</a>

      <details class="navdrop" data-navdrop>
        <summary class="navdrop__sum" aria-label="Leistungen öffnen">
          Leistungen <span class="navdrop__chev" aria-hidden="true">▾</span>
        </summary>

        <div class="navdrop__panel" role="menu" aria-label="Leistungen">
          <a href="/leistungen/schiefer/" role="menuitem">Schiefer</a>
          <a href="/leistungen/metall/" role="menuitem">Metall</a>
          <a href="/leistungen/holz/" role="menuitem">Holz</a>
          <a href="/kontakt/?p=Custom" role="menuitem">Custom</a>

          <div class="navdrop__sep" aria-hidden="true"></div>

          <a href="/tools/kalkulator/" role="menuitem">Kalkulator</a>
          <a href="/service/" role="menuitem">Downloads</a>
        </div>
      </details>

      <a href="/ueber/">Über</a>
      <a href="/kontakt/">Kontakt</a>
      <a href="/rechtliches/impressum.html">Impressum</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="hero">
    <span class="badge"><i></i> Tool</span>
    <h1>Kalkulator (V0)</h1>
    <p class="lead">
      Wähle Material + Variante + Format. Danach bekommst du eine fertige Nachricht,
      die du mir 1:1 per WhatsApp oder Mail schicken kannst.
    </p>

    <div class="notice">
      <strong style="color:var(--text)">Hinweis:</strong><br>
      Das ist V0 – ohne Warenkorb. Aber: deine Auswahl ist sauber strukturiert und direkt abschickbar.
    </div>
  </section>

  <section class="section">
    <div class="section-head">
      <h2>Konfiguration</h2>
      <p class="small muted">Stückzahl & Upgrades sind drin. Metall/Holz kommen als nächstes.</p>
    </div>

    <div class="calcbox">
      <div class="calcgrid">
        <div>
          <label class="smalllab" for="cat">Oberkategorie</label>
          <select id="cat">
            <option value="schiefer">Schiefer</option>
            <option value="metall" disabled>Metall (kommt als nächstes)</option>
            <option value="holz" disabled>Holz (kommt danach)</option>
            <option value="acryl" disabled>Acryl (später)</option>
          </select>
        </div>

        <div>
          <label class="smalllab" for="variant">Ausführung</label>
          <select id="variant"></select>
        </div>

        <div>
          <label class="smalllab" for="format">Format</label>
          <select id="format"></select>
        </div>

        <div>
          <label class="smalllab" for="qty">Stückzahl</label>
          <input id="qty" type="number" min="1" max="50" value="1" />
        </div>
      </div>

      <div class="subcard" id="upgradesBox">
        <div class="inline" style="margin-bottom:10px">
          <div class="pill" id="inclPill">inkl. …</div>
          <div class="pill" id="notePill">Hinweis …</div>
        </div>

        <div class="grid">
          <div class="card" style="margin:0">
            <h3 style="margin-top:0">Upgrades</h3>

            <div class="checkrow">
              <input type="checkbox" id="widmung">
              <div>
                <div><strong>Signatur / Widmung</strong> <span class="muted" id="p_widmung"></span></div>
                <div class="muted">z. B. „In Liebe“, kurze Widmung, Signatur.</div>
              </div>
            </div>

            <div style="height:10px"></div>

            <div class="radioStack" aria-label="Standfuß Auswahl">
              <div class="checkrow">
                <input type="radio" name="standfuss" id="sf_none" value="none" checked>
                <div>
                  <div><strong>Kein Standfuß</strong></div>
                  <div class="muted">—</div>
                </div>
              </div>

              <div class="checkrow">
                <input type="radio" name="standfuss" id="sf_std" value="std">
                <div>
                  <div><strong>3D-Standfuß (schwarz)</strong> <span class="muted" id="p_sf_std"></span></div>
                  <div class="muted">Standard.</div>
                </div>
              </div>
            </div>

            <div style="height:10px"></div>

            <div class="checkrow">
              <input type="checkbox" id="wandhalter">
              <div>
                <div><strong>3D-Wandhalterung</strong> <span class="muted" id="p_wandhalter"></span></div>
                <div class="muted">Zum Aufhängen.</div>
              </div>
            </div>

            <div style="height:10px"></div>

            <div class="checkrow">
              <input type="checkbox" id="express">
              <div>
                <div><strong>Express (3 Werktage)</strong> <span class="muted" id="p_express"></span></div>
                <div class="muted">ab Eingang aller nötigen Infos/Unterlagen.</div>
              </div>
            </div>
          </div>

          <div class="card" style="margin:0">
            <h3 style="margin-top:0">Versand / Abholung</h3>

            <div class="radioStack">
              <div class="checkrow">
                <input type="radio" name="ship" id="ship_pickup" value="pickup" checked>
                <div>
                  <div><strong>Abholung / Übergabe</strong></div>
                  <div class="muted">Kein Versand berechnet.</div>
                </div>
              </div>

              <div class="checkrow">
                <input type="radio" name="ship" id="ship_send" value="send">
                <div>
                  <div><strong>Versand</strong> <span class="muted" id="p_ship"></span></div>
                  <div class="muted">Mindestbestellwert Versand: 29,95 € · Versandfrei ab 80,00 €</div>
                </div>
              </div>
            </div>

            <div class="hr" style="margin:14px 0"></div>

            <div class="total" id="total">Gesamt: —</div>
            <div class="warn" id="warn"></div>
            <div class="oknote" id="oknote"></div>

            <div class="section" style="margin-top:14px">
              <label class="smalllab" for="note">Notiz (optional)</label>
              <textarea id="note" placeholder="z. B. Koordinaten, Symbolwunsch, Deadline, besonderer Wunsch…"></textarea>
            </div>

            <div class="cta" style="margin-top:12px">
              <a class="btn primary" id="waLink" href="#" rel="noopener">WhatsApp</a>
              <a class="btn" id="mailLink" href="#">E-Mail</a>
              <a class="btn" href="/kontakt/?p=Sonderanfrage">Sonderfall</a>
            </div>
          </div>
        </div>
      </div>

    </div>
  </section>
</main>

<footer>
  <div class="wrap foot">
    <div class="small">© <span id="y"></span> Luderbein</div>
    <div class="small">
      <a href="/rechtliches/impressum.html">Impressum</a> ·
      <a href="/rechtliches/datenschutz.html">Datenschutz</a>
    </div>
  </div>
</footer>

<script src="/assets/site.js"></script>
<script src="/assets/nav-dropdown.js"></script>
<script src="/assets/pricing.js"></script>
<script>
  document.getElementById('y').textContent = new Date().getFullYear();

  (function(){
    const P = window.LUDERBEIN_PRICING;
    if(!P || !P.products) return;

    const $cat     = document.getElementById('cat');
    const $variant = document.getElementById('variant');
    const $format  = document.getElementById('format');
    const $qty     = document.getElementById('qty');

    const $widmung     = document.getElementById('widmung');
    const $wandhalter  = document.getElementById('wandhalter');
    const $express     = document.getElementById('express');

    const $sfNone = document.getElementById('sf_none');
    const $sfStd  = document.getElementById('sf_std');

    const $shipPickup = document.getElementById('ship_pickup');
    const $shipSend   = document.getElementById('ship_send');

    const $total = document.getElementById('total');
    const $warn  = document.getElementById('warn');
    const $oknote = document.getElementById('oknote');

    const $wa = document.getElementById('waLink');
    const $mail = document.getElementById('mailLink');
    const $note = document.getElementById('note');

    const $inclPill = document.getElementById('inclPill');
    const $notePill = document.getElementById('notePill');

    function euro(n){
      return (Math.round(n*100)/100).toFixed(2).replace('.',',') + ' €';
    }

    function getSchiefer(){
      return P.products.schiefer;
    }

    function fillVariant(){
      const cat = $cat.value;
      $variant.innerHTML = '';
      if(cat !== 'schiefer') {
        const opt = document.createElement('option');
        opt.value = '';
        opt.textContent = 'kommt bald';
        $variant.appendChild(opt);
        $variant.disabled = true;
        $format.disabled = true;
        return;
      }

      $variant.disabled = false;
      const S = getSchiefer();

      Object.keys(S.variants).forEach(key => {
        const opt = document.createElement('option');
        opt.value = key;
        opt.textContent = S.variants[key].label;
        $variant.appendChild(opt);
      });
    }

    function fillFormat(){
      const cat = $cat.value;
      $format.innerHTML = '';
      if(cat !== 'schiefer') return;

      const S = getSchiefer();
      const vKey = $variant.value;
      const V = S.variants[vKey];

      V.formats.forEach(f => {
        const opt = document.createElement('option');
        opt.value = f.id;
        opt.textContent = `${f.label} – ${euro(f.price)}`;
        $format.appendChild(opt);
      });

      $inclPill.textContent = S.includes || 'inkl. …';
      $notePill.textContent = (V.note ? V.note : (P.meta.note || ''));
    }

    function getSelected(){
      const cat = $cat.value;
      if(cat !== 'schiefer') return null;

      const S = getSchiefer();
      const vKey = $variant.value;
      const V = S.variants[vKey];

      const fId = $format.value;
      const F = V.formats.find(x => x.id === fId);

      const qty = Math.max(1, parseInt($qty.value || '1', 10));

      const U = S.upgrades;

      const upgrades = [];
      if($widmung.checked) upgrades.push({ key:'widmung', ...U.widmung });

      const standfussVal = ($sfStd.checked ? 'std' : 'none');
      if(standfussVal === 'std') upgrades.push({ key:'standfuss_std', ...U.standfuss_std });

      if($wandhalter.checked) upgrades.push({ key:'wandhalter', ...U.wandhalter });
      if($express.checked) upgrades.push({ key:'express', ...U.express });

      const wantsShipping = $shipSend.checked;

      return { S, vKey, V, F, qty, upgrades, wantsShipping };
    }

    function calc(){
      const sel = getSelected();
      if(!sel || !sel.F){
        $total.textContent = 'Gesamt: —';
        return;
      }

      const { S, V, F, qty, upgrades, wantsShipping } = sel;

      const base = F.price * qty;
      const up = upgrades.reduce((a,u)=>a + (u.price||0), 0) * qty; // V0: Upgrades pro Stück
      let subtotal = base + up;

      let ship = 0;
      let warnTxt = '';
      let okTxt = '';

      if(wantsShipping && P.shipping && P.shipping.enabled){
        const minShip = P.shipping.minOrderForShipping;
        const freeFrom = P.shipping.freeShippingFrom;

        if(subtotal >= freeFrom){
          ship = 0;
          okTxt = `Versandkostenfrei ab ${euro(freeFrom)} erreicht.`;
        } else {
          ship = P.shipping.basePrice;
          okTxt = `Versand: ${euro(ship)} (V0-Standard).`;
        }

        if(subtotal < minShip){
          warnTxt = `Achtung: Mindestbestellwert für Versand ist ${euro(minShip)}. (Du kannst trotzdem anfragen – ich kläre das dann.)`;
        }
      }

      const total = subtotal + ship;
      $total.textContent = `Gesamt: ${euro(total)}`;

      if(warnTxt){
        $warn.style.display = 'block';
        $warn.textContent = warnTxt;
      } else {
        $warn.style.display = 'none';
        $warn.textContent = '';
      }

      if(okTxt){
        $oknote.style.display = 'block';
        $oknote.textContent = okTxt;
      } else {
        $oknote.style.display = 'none';
        $oknote.textContent = '';
      }

      const lines = [];
      lines.push(`Hi Luderbein, ich möchte kalkulieren/anfragen:`);
      lines.push(`- Material: ${S.label}`);
      lines.push(`- Ausführung: ${V.label}`);
      lines.push(`- Format: ${F.label}`);
      lines.push(`- Stückzahl: ${qty}`);

      if(upgrades.length){
        lines.push(`- Upgrades: ${upgrades.map(u => `${u.label} (${euro(u.price)})`).join(', ')}`);
      } else {
        lines.push(`- Upgrades: keine`);
      }

      lines.push(`- Versand: ${wantsShipping ? 'ja' : 'nein'}`);
      lines.push(`- Gesamt (V0): ${euro(total)} (${P.meta.note})`);

      const extra = ($note.value || '').trim();
      if(extra) lines.push(`- Notiz: ${extra}`);

      lines.push(`Foto/Infos schicke ich gleich mit.`);

      const msg = lines.join('\n');

      $wa.href = 'https://wa.me/491725925858?text=' + encodeURIComponent(msg);

      const subject = `Kalkulation ${S.label} – ${V.label} – Luderbein`;
      const body = msg + '\n\nDanke!';
      $mail.href = 'mailto:luderbein_gravur@icloud.com?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(body);
    }

    function bindPriceLabels(){
      const U = getSchiefer().upgrades;

      document.getElementById('p_widmung').textContent = `(+${euro(U.widmung.price)})`;
      document.getElementById('p_sf_std').textContent = `(+${euro(U.standfuss_std.price)})`;
      document.getElementById('p_wandhalter').textContent = `(+${euro(U.wandhalter.price)})`;
      document.getElementById('p_express').textContent = `(+${euro(U.express.price)})`;

      if(P.shipping && P.shipping.enabled){
        document.getElementById('p_ship').textContent = `(ab ${euro(P.shipping.basePrice)})`;
      }
    }

    function applyUrlPrefill(){
      const params = new URLSearchParams(location.search);
      const t = (params.get('t') || '').toLowerCase().trim();
      const v = (params.get('v') || '').toLowerCase().trim();

      if(t === 'schiefer') $cat.value = 'schiefer';

      const vMap = {
        foto: 'fotogravur',
        fotogravur: 'fotogravur',
        gedenk: 'gedenktafeln',
        gedenktafel: 'gedenktafeln',
        gedenktafeln: 'gedenktafeln'
      };

      const vKey = vMap[v];
      if(vKey){
        setTimeout(() => {
          $variant.value = vKey;
          fillFormat();
          calc();
        }, 0);
      }
    }

    $cat.addEventListener('change', () => { fillVariant(); fillFormat(); calc(); });
    $variant.addEventListener('change', () => { fillFormat(); calc(); });
    $format.addEventListener('change', calc);
    $qty.addEventListener('input', calc);

    [$widmung, $wandhalter, $express, $sfNone, $sfStd, $shipPickup, $shipSend].forEach(el => {
      el.addEventListener('change', calc);
    });

    $note.addEventListener('input', calc);

    fillVariant();
    fillFormat();
    bindPriceLabels();
    applyUrlPrefill();
    calc();
  })();
</script>
</body>
</html>
