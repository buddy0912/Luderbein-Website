<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kalkulator – Luderbein</title>
  <meta name="description" content="Kalkulator (V0) – Fixpreise für Schiefer, Metall als Richtlogik. Erst kalkulieren, dann anfragen." />
  <link rel="stylesheet" href="/assets/style.css" />
</head>

<body>
  <header>
    <div class="wrap nav">
      <a class="brand" href="/">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <strong>Luderbein</strong><br>
          <span>Schwibbögen • Gravur • Sonderwünsche</span>
        </div>
      </a>

      <button class="navbtn" type="button" data-nav-toggle aria-expanded="false" aria-label="Menü öffnen">
        <span class="navicon"><span></span></span>
      </button>

      <nav class="menu" data-nav data-open="0" aria-label="Hauptmenü">
        <a href="/">Start</a>
        <a href="/leistungen/">Leistungen</a>
        <a href="/schwibboegen/">Schwibbögen</a>
        <a href="/ueber/">Über</a>
        <a href="/kontakt/">Kontakt</a>
        <a href="/rechtliches/impressum.html">Impressum</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <span class="badge"><i></i> Tool – V0</span>
      <h1>Kalkulator</h1>
      <p class="lead">
        Erst Preise/Logik checken, dann erst anfragen. Spart dir und mir Zeit.
      </p>

      <div class="notice" style="margin-top:14px">
        <strong style="color:var(--text)">Kleinunternehmer (§19 UStG):</strong> keine MwSt. ausgewiesen.
      </div>
    </section>

    <div class="hr"></div>

    <section class="section" aria-label="Kalkulator Auswahl">
      <div class="section-head">
        <h2>1) Wähle dein Ding</h2>
        <p class="small muted">Wenn du über Metall kommst, wird Metall automatisch vorausgewählt.</p>
      </div>

      <div class="card" style="padding:14px">
        <label class="small" for="serviceSelect" style="display:block;margin-bottom:6px;color:var(--muted)">Was willst du?</label>
        <select id="serviceSelect" class="input" style="width:100%">
          <option value="schiefer-foto">Schiefer – Fotogravur (Fixpreise)</option>
          <option value="metall">Metall – Gravur (V0)</option>
        </select>

        <p class="small muted" style="margin-top:10px">
          Tipp: Direktlink zum Vorwählen:
          <span style="opacity:.9">/tools/kalkulator/?t=metall</span>
        </p>
      </div>
    </section>

    <!-- SCHIEFER -->
    <section class="section" id="sectionSchiefer" style="display:none" aria-label="Schiefer Fixpreise">
      <div class="section-head">
        <h2>Schiefer – Fixpreise (V0)</h2>
        <p class="small muted">inkl. Fotoaufbereitung + Gravur + Klarlack.</p>
      </div>

      <div class="products">
        <article class="productcard" style="grid-column:1/-1">
          <div class="meta">
            <span class="price">Fixpreise</span><span>•</span><span>klar & fair</span>
          </div>

          <div style="display:grid;gap:12px;margin-top:10px">
            <div>
              <label class="small" for="schieferSize" style="display:block;margin-bottom:6px;color:var(--muted)">Größe / Format</label>
              <select id="schieferSize" class="input" style="width:100%">
                <option value="10x10" data-base="19.95">10×10 cm (eckig) / 10 cm rund – 19,95 €</option>
                <option value="15x15" data-base="29.95">15×15 cm (eckig) / 15 cm rund – 29,95 €</option>
                <option value="20x20" data-base="39.95">20×20 cm (eckig) / 20 cm rund – 39,95 €</option>
              </select>
            </div>

            <div>
              <label class="small" for="schieferExtra" style="display:block;margin-bottom:6px;color:var(--muted)">Extra: Was soll ich wissen?</label>
              <textarea id="schieferExtra" class="input" rows="3" placeholder="z.B. Geschenk bis Datum X, Stilwunsch, Abholung/Versand, & ganz wichtig: Skizzen/Screenshots sind sehr willkommen."></textarea>
            </div>

            <div class="card" style="padding:12px">
              <div class="small muted" style="margin-bottom:10px">Upgrades (optional)</div>

              <label class="small" style="display:flex;gap:10px;align-items:flex-start;cursor:pointer">
                <input id="upgSig" type="checkbox" data-price="4.95" style="margin-top:3px">
                <span>
                  <strong>Signatur / Widmung</strong> (+4,95 €)<br>
                  <span class="muted">Dezent, sauber. Kein Kitsch.</span>
                </span>
              </label>

              <div style="height:10px"></div>

              <label class="small" style="display:flex;gap:10px;align-items:flex-start;cursor:pointer">
                <input id="upgStand" type="checkbox" data-price="6.95" style="margin-top:3px">
                <span>
                  <strong>Standfuß (schwarz)</strong> (+6,95 €)<br>
                  <span class="muted">Optional. Macht’s „aufgestellt“ statt „angelehnt“.</span>
                </span>
              </label>
            </div>

            <div class="notice" id="schieferSummary" style="margin-top:4px">
              <strong style="color:var(--text)">Summe:</strong>
              <span id="schieferTotal">–</span>
              <span class="muted"> (Fixpreis)</span>
            </div>

            <div class="cta" style="margin-top:6px">
              <a class="btn primary" id="btnSchieferAnfrage" href="/kontakt/">Mit Angaben anfragen</a>
              <a class="btn" href="/leistungen/schiefer/">Preise / Details</a>
            </div>

            <p class="small muted" style="margin-top:6px">
              V0-Regel: Erst hier kalkulieren → dann anfragen. So bleibt’s für beide Seiten entspannt.
            </p>
          </div>
        </article>
      </div>
    </section>

    <!-- METALL -->
    <section class="section" id="sectionMetall" style="display:none" aria-label="Metall V0">
      <div class="section-head">
        <h2>Metall – Gravur (V0)</h2>
        <p class="small muted">Richtlogik – Fixpreise bauen wir im Kalkulationschat sauber auf.</p>
      </div>

      <div class="products">
        <article class="productcard" style="grid-column:1/-1">
          <div class="meta">
            <span class="price">Metall</span><span>•</span><span>Tags / Plaketten / Kleinserien</span>
          </div>

          <h3>Metallgravur</h3>
          <p class="kicker">
            Hundemarken, Tags, Plaketten, kleine Serien – sauber, kontrastreich, haltbar.
            Solange die Fixpreise noch nicht final sind: erst Kalkulator-Daten sammeln, dann Kontakt.
          </p>

          <div style="display:grid;gap:12px;margin-top:10px">
            <div>
              <label class="small" for="metallWas" style="display:block;margin-bottom:6px;color:var(--muted)">Was genau?</label>
              <select id="metallWas" class="input" style="width:100%">
                <option value="Tags / Hundemarken">Tags / Hundemarken</option>
                <option value="Plakette / Schild">Plakette / Schild</option>
                <option value="Kleinserie">Kleinserie</option>
                <option value="Sonstiges">Sonstiges</option>
              </select>
            </div>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
              <div>
                <label class="small" for="metallMenge" style="display:block;margin-bottom:6px;color:var(--muted)">Menge</label>
                <input id="metallMenge" class="input" type="number" min="1" value="1" />
              </div>
              <div>
                <label class="small" for="metallGroesse" style="display:block;margin-bottom:6px;color:var(--muted)">Größe / Format</label>
                <input id="metallGroesse" class="input" type="text" placeholder="z.B. 30×15 mm, Ø 25 mm" />
              </div>
            </div>

            <div>
              <label class="small" for="metallText" style="display:block;margin-bottom:6px;color:var(--muted)">Text / Inhalt</label>
              <textarea id="metallText" class="input" rows="3" placeholder="Text, Icons, ggf. Logo – Skizzen/Screenshots sind sehr willkommen."></textarea>
            </div>

            <div class="notice">
              <strong style="color:var(--text)">V0-Regel:</strong>
              Bitte erst Daten sammeln (oben), dann Kontakt – damit wir nicht zehn Rückfragen drehen.
            </div>

            <div class="cta">
              <a class="btn primary" id="btnMetallKontakt" href="/kontakt/">Kontakt</a>
              <a class="btn" href="/leistungen/metall/">Preise / Details</a>
            </div>
          </div>
        </article>
      </div>
    </section>

    <div class="hr"></div>

    <section class="section">
      <h2>Kontakt</h2>
      <p class="small">E-Mail: <a href="mailto:luderbein_gravur@icloud.com">luderbein_gravur@icloud.com</a></p>
      <p class="small">Instagram: <a href="https://instagram.com/luderbein_gravur" rel="noopener">@Luderbein_Gravur</a></p>
    </section>
  </main>

  <footer>
    <div class="wrap foot">
      <div class="small">© <span id="y"></span> Luderbein</div>
      <div class="small">
        <a href="/rechtliches/impressum.html">Impressum</a> ·
        <a href="/rechtliches/datenschutz.html">Datenschutz</a>
      </div>
    </div>
  </footer>

  <script src="/assets/site.js"></script>

  <script>
  (function(){
    try {
      // year
      var y = document.getElementById('y');
      if (y) y.textContent = new Date().getFullYear();

      var serviceSelect = document.getElementById('serviceSelect');
      var sectionSchiefer = document.getElementById('sectionSchiefer');
      var sectionMetall = document.getElementById('sectionMetall');

      var schieferSize = document.getElementById('schieferSize');
      var schieferExtra = document.getElementById('schieferExtra');
      var upgSig = document.getElementById('upgSig');
      var upgStand = document.getElementById('upgStand');
      var schieferTotal = document.getElementById('schieferTotal');
      var btnSchieferAnfrage = document.getElementById('btnSchieferAnfrage');

      var metallWas = document.getElementById('metallWas');
      var metallMenge = document.getElementById('metallMenge');
      var metallGroesse = document.getElementById('metallGroesse');
      var metallText = document.getElementById('metallText');
      var btnMetallKontakt = document.getElementById('btnMetallKontakt');

      function money(n){
        try { return (Math.round(n * 100) / 100).toFixed(2).replace('.', ',') + ' €'; }
        catch(e){ return '–'; }
      }

      function getDefaultService(){
        var params = new URLSearchParams(location.search);
        var t = (params.get('t') || params.get('type') || params.get('service') || '').trim().toLowerCase();

        if (t.includes('metall')) return 'metall';
        if (t.includes('schiefer')) return 'schiefer-foto';

        // referrer fallback (gleiches origin -> klappt bei dir meistens)
        var r = (document.referrer || '').toLowerCase();
        if (r.includes('/leistungen/metall')) return 'metall';
        if (r.includes('/leistungen/schiefer')) return 'schiefer-foto';

        return 'schiefer-foto';
      }

      function showService(val){
        if (!val) val = 'schiefer-foto';

        if (sectionSchiefer) sectionSchiefer.style.display = (val === 'schiefer-foto') ? '' : 'none';
        if (sectionMetall) sectionMetall.style.display = (val === 'metall') ? '' : 'none';

        if (val === 'schiefer-foto') {
          recalcSchiefer();
        } else if (val === 'metall') {
          updateMetallLink();
        }
      }

      function baseSchiefer(){
        var opt = schieferSize && schieferSize.options ? schieferSize.options[schieferSize.selectedIndex] : null;
        var base = opt ? parseFloat(opt.getAttribute('data-base') || '0') : 0;
        return isFinite(base) ? base : 0;
      }

      function recalcSchiefer(){
        if (!schieferTotal) return;

        var total = baseSchiefer();

        if (upgSig && upgSig.checked) total += parseFloat(upgSig.getAttribute('data-price') || '0') || 0;
        if (upgStand && upgStand.checked) total += parseFloat(upgStand.getAttribute('data-price') || '0') || 0;

        schieferTotal.textContent = money(total);

        // Anfrage-Link bauen (p + size + note)
        var sizeLabel = '';
        try {
          sizeLabel = schieferSize.options[schieferSize.selectedIndex].textContent.split('–')[0].trim();
        } catch(e){ sizeLabel = ''; }

        var note = (schieferExtra && schieferExtra.value || '').trim();

        var url = new URL('/kontakt/', location.origin);
        url.searchParams.set('p', 'Schiefer-Fotogravur');
        if (sizeLabel) url.searchParams.set('size', sizeLabel);
        if (note) url.searchParams.set('note', note);

        if (btnSchieferAnfrage) btnSchieferAnfrage.setAttribute('href', url.pathname + url.search);
      }

      function updateMetallLink(){
        // Kontakt-Link mit Kontext füllen (ohne Zwang)
        var was = (metallWas && metallWas.value || '').trim();
        var menge = (metallMenge && metallMenge.value || '').trim();
        var groesse = (metallGroesse && metallGroesse.value || '').trim();
        var text = (metallText && metallText.value || '').trim();

        var p = 'Metallgravur';
        var size = [];
        if (was) size.push(was);
        if (groesse) size.push(groesse);
        if (menge) size.push('Menge: ' + menge);

        var url = new URL('/kontakt/', location.origin);
        url.searchParams.set('p', p);
        if (size.length) url.searchParams.set('size', size.join(' – '));
        if (text) url.searchParams.set('note', text);

        if (btnMetallKontakt) btnMetallKontakt.setAttribute('href', url.pathname + url.search);
      }

      // Init: Default wählen
      if (serviceSelect) {
        serviceSelect.value = getDefaultService();
        serviceSelect.addEventListener('change', function(){ showService(serviceSelect.value); });
      }

      // Listeners Schiefer
      if (schieferSize) schieferSize.addEventListener('change', recalcSchiefer);
      if (schieferExtra) schieferExtra.addEventListener('input', recalcSchiefer);
      if (upgSig) upgSig.addEventListener('change', recalcSchiefer);
      if (upgStand) upgStand.addEventListener('change', recalcSchiefer);

      // Listeners Metall
      if (metallWas) metallWas.addEventListener('change', updateMetallLink);
      if (metallMenge) metallMenge.addEventListener('input', updateMetallLink);
      if (metallGroesse) metallGroesse.addEventListener('input', updateMetallLink);
      if (metallText) metallText.addEventListener('input', updateMetallLink);

      // Anzeige initial
      showService(serviceSelect ? serviceSelect.value : getDefaultService());
    } catch (e) {
      // NIE White-Page riskieren
      console && console.log && console.log('Kalkulator init skipped:', e);
    }
  })();
  </script>
</body>
</html>
